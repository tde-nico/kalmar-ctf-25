import string
import subprocess

code = """
loadall((new Uint8Array([67, 9, 18, 117, 115, 101, 32, 115, 116, 114, 105, 112, 18, 99, 104, 101, 99, 107, 70, 108, 97, 103, 2, 95, 6, 109, 97, 112, 24, 102, 114, 111, 109, 67, 104, 97, 114, 67, 111, 100, 101, 20, 99, 104, 97, 114, 67, 111, 100, 101, 65, 116, 10, 112, 114, 105, 110, 116, 22, 87, 114, 111, 110, 103, 32, 102, 108, 97, 103, 33, 22, 82, 105, 103, 104, 116, 32, 102, 108, 97, 103, 33, 12, 0, 2, 2, 162, 1, 0, 2, 0, 3, 0, 1, 19, 0, 8, 204, 4, 227, 0, 0, 0, 203, 200, 194, 0, 21, 67, 228, 0, 0, 0, 207, 40, 12, 67, 2, 2, 200, 3, 1, 6, 1, 32, 0, 3, 219, 3, 0, 97, 4, 0, 97, 3, 0, 97, 2, 0, 97, 1, 0, 97, 0, 0, 194, 0, 77, 229, 0, 0, 0, 203, 98, 0, 0, 204, 193, 1, 205, 195, 206, 191, 98, 191, 57, 191, 35, 191, 34, 191, 42, 191, 41, 191, 104, 191, 79, 191, 18, 191, 28, 191, 29, 191, 75, 191, 55, 183, 191, 49, 191, 33, 191, 37, 191, 46, 191, 65, 191, 21, 191, 120, 191, 99, 191, 123, 191, 68, 191, 112, 191, 20, 191, 78, 191, 19, 191, 61, 191, 31, 191, 54, 191, 122, 38, 32, 0, 191, 39, 76, 32, 0, 0, 128, 191, 123, 76, 33, 0, 0, 128, 191, 23, 76, 34, 0, 0, 128, 191, 29, 76, 35, 0, 0, 128, 191, 30, 76, 36, 0, 0, 128, 191, 52, 76, 37, 0, 0, 128, 190, 76, 38, 0, 0, 128, 188, 76, 39, 0, 0, 128, 191, 103, 76, 40, 0, 0, 128, 190, 76, 41, 0, 0, 128, 191, 95, 76, 42, 0, 0, 128, 191, 127, 76, 43, 0, 0, 128, 188, 76, 44, 0, 0, 128, 191, 57, 76, 45, 0, 0, 128, 191, 58, 76, 46, 0, 0, 128, 189, 76, 47, 0, 0, 128, 191, 105, 76, 48, 0, 0, 128, 191, 84, 76, 49, 0, 0, 128, 191, 60, 76, 50, 0, 0, 128, 191, 55, 76, 51, 0, 0, 128, 191, 34, 76, 52, 0, 0, 128, 191, 44, 76, 53, 0, 0, 128, 191, 100, 76, 54, 0, 0, 128, 191, 90, 76, 55, 0, 0, 128, 191, 84, 76, 56, 0, 0, 128, 191, 100, 76, 57, 0, 0, 128, 187, 76, 58, 0, 0, 128, 191, 12, 76, 59, 0, 0, 128, 191, 59, 76, 60, 0, 0, 128, 191, 54, 76, 61, 0, 0, 128, 191, 64, 76, 62, 0, 0, 128, 191, 76, 76, 63, 0, 0, 128, 191, 92, 76, 64, 0, 0, 128, 191, 120, 76, 65, 0, 0, 128, 66, 230, 0, 0, 0, 194, 2, 36, 1, 0, 66, 92, 0, 0, 0, 195, 36, 1, 0, 197, 4, 97, 5, 0, 183, 197, 5, 98, 5, 0, 211, 235, 164, 236, 76, 98, 3, 0, 56, 155, 0, 0, 0, 66, 231, 0, 0, 0, 211, 66, 232, 0, 0, 0, 98, 5, 0, 36, 1, 0, 98, 2, 0, 191, 95, 174, 175, 36, 1, 0, 158, 17, 99, 3, 0, 14, 98, 1, 0, 98, 2, 0, 211, 66, 232, 0, 0, 0, 98, 5, 0, 36, 1, 0, 242, 17, 99, 2, 0, 14, 98, 5, 0, 146, 99, 5, 0, 14, 238, 174, 98, 3, 0, 98, 4, 0, 171, 236, 14, 56, 233, 0, 0, 0, 4, 234, 0, 0, 0, 241, 14, 41, 56, 233, 0, 0, 0, 4, 235, 0, 0, 0, 241, 14, 41, 12, 66, 2, 2, 0, 2, 1, 2, 3, 0, 0, 57, 0, 97, 0, 0, 183, 203, 98, 0, 0, 191, 16, 164, 236, 41, 211, 211, 191, 15, 162, 175, 219, 211, 191, 13, 161, 175, 219, 211, 191, 17, 162, 175, 215, 212, 211, 175, 216, 211, 212, 191, 11, 162, 175, 215, 98, 0, 0, 146, 99, 0, 0, 14, 238, 209, 211, 212, 175, 40, 6, 0, 0, 32, 241, 11, 124, 234, 65, 12, 66, 2, 2, 0, 2, 0, 2, 4, 0, 0, 16, 0, 56, 155, 0, 0, 0, 66, 231, 0, 0, 0, 211, 212, 175, 37, 1, 0])).buffer)
checkFlag('%s')
"""

cmd = """./chall.amd64.patched tmp.js 2>&1 | grep "0'b8" """

correct = 'b8!!.,nH\u001a\u0015\u0017@;\u000d?.5?S\u0006lvmSh\u000dT\u0008!\u0002(e\u0007Z5>:\u0011!"O.uT)\u0014\u0014)Ye\u000e\u0004\u0016\u0019Rml]>7\u0007\u000b~s\u001c9'

# flag = 'kalmar{NOW_ThA7-y0U_kn0W-HOW-Qu1CKj5-W0rKs-CaN_yOu_PWN_it_4$_WelL}'

flag = 'kalmar{' + 'A' * 100 + '}'
flag = list(flag)
for i in range(7, len(flag)):
	for c in ('-_}' + string.printable):
		tmp = list(flag)
		tmp[i] = c
		tmp_code = code % ''.join(tmp)
		with open('tmp.js', 'w') as f:
			f.write(tmp_code)
		p = subprocess.Popen(cmd, stdout=subprocess.PIPE, shell=True)
		res = p.communicate()[0].strip().decode().split('\n')[-2]
		res = res[len('Freeing 0\''):]
		res = eval(f'str("""{res}""")')
		print(''.join(tmp)[:i+1], ord(res[i]), ord(correct[i]))
		if res[i] == correct[i]:
			flag[i] = c
			break

